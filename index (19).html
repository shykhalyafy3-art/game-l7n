<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>لعبة القفز — اليافعي L7N</title>
<style>
  :root{--bg1:#c3eafc;--bg2:#80deea;--ground:#333;--accent:#ff5722}
  *{box-sizing:border-box;font-family:Arial, Tahoma, sans-serif}
  body{margin:0;background:linear-gradient(180deg,var(--bg1),var(--bg2));display:flex;align-items:center;justify-content:center;height:100vh}
  .wrap{width:100%;max-width:900px;padding:12px}
  #game{position:relative;width:100%;height:360px;background:linear-gradient(#87cefa,#7ec8e3);overflow:hidden;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,0.18)}
  #sky-text{position:absolute;top:16px;left:50%;transform:translateX(-50%);color:#fff;font-weight:700;text-shadow:0 2px 6px rgba(0,0,0,0.4);font-size:10px}
  #score{position:absolute;top:16px;right:18px;background:rgba(255,255,255,0.12);backdrop-filter:blur(4px);padding:8px 12px;border-radius:10px;color:#fff;font-weight:700}
  #ground{position:absolute;left:0;right:0;bottom:0;height:60px;background:var(--ground)}

  /* player (simple person drawn with CSS) */
  #player{position:absolute;left:70px;bottom:60px;width:48px;height:64px;display:flex;flex-direction:column;align-items:center;pointer-events:none}
  .head{width:28px;height:28px;border-radius:50%;background:#ffd9b3;margin-top:2px;box-shadow:inset 0 -4px 0 rgba(0,0,0,0.06)}
  .body{width:18px;height:26px;background:var(--accent);margin-top:4px;border-radius:6px;position:relative}
  .leg{position:absolute;bottom:-6px;width:6px;height:20px;background:#222;border-radius:4px;left:2px;transform-origin:top center}
  .leg.right{left:auto;right:2px}
  /* legs resting */
  .leg{transform:rotate(0deg)}
  /* jump animation: legs move */
  .jumping .leg{animation:legSwing 250ms linear infinite}
  @keyframes legSwing{
    0%{transform:rotate(0deg)}
    50%{transform:rotate(30deg)}
    100%{transform:rotate(0deg)}
  }

  /* obstacle */
  #obstacle{position:absolute;right:-120px;bottom:60px;width:70px;height:40px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:800;
            box-shadow:0 6px 18px rgba(0,0,0,0.18);background:rgba(255,255,255,0.95);color:#222;letter-spacing:0.6px}
  #obstacle .text{font-size:10px;direction:rtl}
  /* message popup */
  #message{position:absolute;left:50%;top:48%;transform:translate(-50%,-50%);padding:16px 22px;border-radius:12px;background:rgba(255,255,255,0.96);box-shadow:0 10px 30px rgba(0,0,0,0.18);display:none;text-align:center;font-weight:700;color:#000;line-height:1.5;max-width:86%}
  #controls-hint{position:absolute;left:16px;top:16px;color:#fff;background:rgba(0,0,0,0.12);padding:8px 10px;border-radius:8px;font-size:13px}

  /* responsive */
  @media (max-width:520px){
    #game{height:320px}
    #player{left:38px;transform:scale(0.86)}
    #obstacle{width:96px;height:52px;font-size:18px}
    #score{right:10px;top:10px;padding:6px 8px}
    #sky-text{font-size:16px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <div id="game" aria-label="لعبة القفز">
      <div id="sky-text">اليافعي - L7N</div>
      <div id="score">نقاط: <span id="points">0</span></div>
      <div id="controls-hint">لمس/كليك للقفز · Space/↑ للقفز</div>

      <div id="player" aria-hidden="true">
        <div class="head"></div>
        <div class="body"><div class="leg left"></div><div class="leg right"></div></div>
      </div>

      <div id="obstacle" aria-hidden="true"><div class="text">الدراسة</div></div>

      <div id="ground" aria-hidden="true"></div>

      <div id="message" role="alert">
        خسرت!<br>
        اضغط زر <span dir="ltr">Enter</span> (في الكيبورد)<br>
        أو المس الشاشة للإعادة
      </div>
    </div>
  </div>

<script>
// Game variables
const player = document.getElementById('player');
const obstacle = document.getElementById('obstacle');
const message = document.getElementById('message');
const pointsEl = document.getElementById('points');
const scoreBox = document.getElementById('score');

let isJumping = false;
let gameOver = false;
let playerY = 60; // bottom from ground
let velocity = 0;
const gravity = 0.8;
const groundHeight = 60;

// obstacle position and speed
let obstacleX = -120;
let baseSpeed = 5; // pixels per frame increment
let speed = baseSpeed;
let score = 0;
let passedThisObstacle = false;

// audio (WebAudio)
const AudioCtx = window.AudioContext || window.webkitAudioContext;
let audioCtx;
function ensureAudio(){ if(!audioCtx) audioCtx = new AudioCtx(); }

function playJumpSound(){
  ensureAudio();
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = 'sine';
  o.frequency.value = 600;
  g.gain.value = 0.12;
  o.connect(g); g.connect(audioCtx.destination);
  o.start(); o.stop(audioCtx.currentTime + 0.08);
}

function playHitSound(){
  ensureAudio();
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = 'square';
  o.frequency.value = 160;
  g.gain.value = 0.2;
  o.connect(g); g.connect(audioCtx.destination);
  o.start();
  g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.4);
  o.stop(audioCtx.currentTime + 0.5);
}

// reset visual states
obstacle.style.right = obstacleX + 'px';
player.style.bottom = playerY + 'px';

function moveObstacleLoop(){
  if(gameOver) return;
  obstacleX += speed;
  if(obstacleX > window.innerWidth + 140){
    obstacleX = -120;
    passedThisObstacle = false;
  }
  obstacle.style.right = obstacleX + 'px';

  // collision detection
  const playerRect = player.getBoundingClientRect();
  const obstacleRect = obstacle.getBoundingClientRect();
  if(playerRect.right > obstacleRect.left + 6 &&
     playerRect.left < obstacleRect.right - 6 &&
     playerRect.bottom > obstacleRect.top + 6){
    // collision
    gameOver = true;
    message.style.display = 'block';
    playHitSound();
  } else {
    // scoring: when obstacle passes player and wasn't yet counted
    if(!passedThisObstacle && (obstacleRect.right < playerRect.left)){
      passedThisObstacle = true;
      score += 1;
      pointsEl.textContent = score;
      // slightly increase speed every 3 points
      speed += 1;
    }
  }

  requestAnimationFrame(moveObstacleLoop);
}

// jump
function jump(){
  if(gameOver) return;
  if(!isJumping){
    isJumping = true;
    velocity = 14; // upward
    player.classList.add('jumping');
    playJumpSound();
    // stop legs animation after short time if still in air, will be removed on landing
    setTimeout(()=>{ if(isJumping){} }, 250);
  }
}

// update player physics
function updatePlayerLoop(){
  if(isJumping){
    playerY += velocity;
    velocity -= gravity;
    if(playerY <= groundHeight){
      // landed
      playerY = groundHeight;
      isJumping = false;
      player.classList.remove('jumping');
    }
    player.style.bottom = playerY + 'px';
  }
  requestAnimationFrame(updatePlayerLoop);
}

// restart
function restartGame(){
  gameOver = false;
  message.style.display = 'none';
  obstacleX = -120;
  obstacle.style.right = obstacleX + 'px';
  playerY = groundHeight;
  player.style.bottom = playerY + 'px';
  isJumping = false;
  player.classList.remove('jumping');
  score = 0;
  pointsEl.textContent = score;
  speed = baseSpeed;
  passedThisObstacle = false;
  // delay briefly and then start loops
  setTimeout(()=>{ moveObstacleLoop(); }, 120);
}

// Controls
document.addEventListener('keydown', (e)=>{
  if(e.code === 'Space' || e.code === 'ArrowUp'){ e.preventDefault(); jump(); }
  if(e.code === 'Enter' && gameOver){ restartGame(); }
});
document.addEventListener('touchstart', (e)=>{ e.preventDefault(); if(gameOver) restartGame(); else jump(); }, {passive:false});
document.addEventListener('mousedown', (e)=>{ if(gameOver) restartGame(); else jump(); });

// start loops
moveObstacleLoop();
updatePlayerLoop();

</script>
</body>
</html>
